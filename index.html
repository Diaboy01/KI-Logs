<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log-Klassifikation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            padding: 10px;
        }
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Log-Klassifikation</h1>
        <p>Fügen Sie Ihre Log-Einträge unten ein, um herauszufinden, ob sie "normal" oder "böse" sind.</p>
        
        <label for="log-input">Log-Einträge:</label>
        <textarea id="log-input" placeholder="Fügen Sie hier Ihre Log-Einträge ein..."></textarea>
        
        <label for="model-file">Modell-Datei (.pkl) hochladen:</label>
        <input type="file" id="model-file" accept=".pkl"><br><br>
        
        <label for="vectorizer-file">Vektorisierer-Datei (.pkl) hochladen:</label>
        <input type="file" id="vectorizer-file" accept=".pkl"><br><br>
        
        <button id="classify-button">Klassifizieren</button>
        
        <div class="result" id="result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js"></script>
    <script type="text/javascript">
        
async function loadPyodideAndClassify() {
    let pyodide = await loadPyodide({
        indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/"
    });

    // Lade die erforderlichen Pakete
    await pyodide.loadPackage(["numpy", "pandas", "scikit-learn", "joblib"]);

    document.getElementById("classify-button").addEventListener("click", async () => {
        const logInput = document.getElementById("log-input").value.trim();
        const modelFile = document.getElementById("model-file").files[0];
        const vectorizerFile = document.getElementById("vectorizer-file").files[0];

        if (!logInput || !modelFile || !vectorizerFile) {
            alert("Bitte geben Sie Log-Einträge ein und laden Sie beide Dateien hoch.");
            return;
        }

        const modelReader = new FileReader();
        const vectorizerReader = new FileReader();

        modelReader.onload = async function(event) {
            const modelArrayBuffer = event.target.result;
            const modelUint8Array = new Uint8Array(modelArrayBuffer);
            pyodide.FS.writeFile('model.pkl', modelUint8Array);

            vectorizerReader.onload = async function(event) {
                const vectorizerArrayBuffer = event.target.result;
                const vectorizerUint8Array = new Uint8Array(vectorizerArrayBuffer);
                pyodide.FS.writeFile('vectorizer.pkl', vectorizerUint8Array);

                const logsArray = logInput.split("\n").map(log => log.trim());

                const pythonCode = `
import joblib
from sklearn.feature_extraction.text import TfidfVectorizer

# Modell und Vektorisierer laden
model = joblib.load('model.pkl')
vectorizer = joblib.load('vectorizer.pkl')

# Log-Einträge verarbeiten
logs = logs_input_js.split("\\n")
log_vectors = vectorizer.transform(logs)

# Vorhersagen treffen
predictions = model.predict_proba(log_vectors)

result = [{"log": log, "normal": round(prob[0], 2), "malicious": round(prob[1], 2)} for log, prob in zip(logs, predictions)]
result
                `;

                pyodide.globals.set("logs_input_js", logInput);

                try {
                    const result = await pyodide.runPythonAsync(pythonCode);
                    document.getElementById("result").innerHTML = `
                        <h3>Ergebnisse:</h3>
                        <ul>
                            ${result.map(r => `
                                <li>
                                    <strong>Log:</strong> ${r.log}<br>
                                    <strong>Normal:</strong> ${r.normal}<br>
                                    <strong>Böse:</strong> ${r.malicious}<br>
                                </li>`).join("")}
                        </ul>
                    `;
                } catch (error) {
                    console.error(error);
                    alert("Fehler bei der Klassifikation. Überprüfen Sie das Modell und den Vektorisierer.");
                }
            };

            vectorizerReader.readAsArrayBuffer(vectorizerFile);
        };

        modelReader.readAsArrayBuffer(modelFile);
    });
}

loadPyodideAndClassify();

    </script>
</body>
</html>
